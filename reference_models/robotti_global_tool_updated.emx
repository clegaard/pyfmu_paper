<?xml version="1.0" encoding="UTF-8"?>
<Document>
 <Model version="4.6" build="4.6.3.7711">
  <Sidops><![CDATA[model 128 184
 description '<Information>
 <Description>
    <Version>4.6</Version>
<IsMainModel>0</IsMainModel>
  <KeepParameterValues>False</KeepParameterValues>
    <LibraryPath>C:\Into-CPS\WP1\T1_2_Agriculture\Confidential\Robotti_model\robotti_global_tool_updated.emx</LibraryPath>
  <TimeStamp>2019-9-23 11:19:00</TimeStamp>
</Description>
</Information>';
 type Mainmodel
 end;
 implementation bg
  submodels
   external_tool_global 88 256
    description '<Information><Description><Version>4.0</Version><LibraryPath>C:\Program Files\20-sim 4.0\System\Submodel.emx</LibraryPath><TimeStamp>2007-10-31 11:32:54</TimeStamp><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues><AllowLibraryUpdate>True</AllowLibraryUpdate><Configuration><struct><member><name>DocumentationMask</name><value><struct></struct></value></member></struct></Configuration></Description></Information>';
    type Submodel
     ports
      signal in velocity_tool;
      signal out F_x;
      signal out F_z;
    end;
    implementation bg
     submodels
      external_tool 376 232
       description '<Information><Description><Version>4.0</Version><LibraryPath>Template\Submodel-Equation.emx</LibraryPath><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues><TimeStamp>2007-11-1 22:32:1</TimeStamp><AllowLibraryUpdate>False</AllowLibraryUpdate><Configuration><struct><member><name>DocumentationMask</name><value><struct></struct></value></member></struct></Configuration></Description></Information>';
       type 'Submodel-Equation'
        ports
         signal in vel;
         signal out F_x_out;
         signal out F_z_out;
       end;
       implementation eq
/* Equation Submodel
Enter you equations here. You can use the Toolbar buttons at the left ( Add , f(x) etc. ).
*/
parameters 
real global m_external;
real global tool_num;
real global depth;
real global A_11, A_12, A_13, A_21, A_22, A_23;
real global v_init;
real global e_rate;
real global number_of_shears;
real global tool_vel;
real global t1, t2;

variables
real F_z_temp;
real F_x_temp;

equations
F_z_temp = 0;
F_x_temp = 0;


if tool_num == 0 then 
F_z_temp = 0;
F_x_temp = 0;
end;

if tool_num == 1 then
	if (m_external-time*e_rate>100) then
		F_z_temp = (m_external-time*e_rate)*9.81;
		F_x_temp = 0;
	else
	F_z_temp = 100*9.81;
	F_x_temp = 0;
	end;
end;


if tool_num == 2 then
	if time < t1 then
		F_x_temp = (A_11 * depth + A_12 * tool_vel + A_13)*number_of_shears;
		F_z_temp = (A_21 * depth + A_22 * tool_vel + A_23)*number_of_shears;
	else
		F_x_temp = 0;
		F_z_temp = 0;
	end;	
	if time > t2 then
		F_x_temp = (A_11 * depth + A_12 * tool_vel + A_13)*number_of_shears;
		F_z_temp = (A_21 * depth + A_22 * tool_vel + A_23)*number_of_shears;
	end;	
end;


F_z_out = F_z_temp*1;
F_x_out = F_x_temp*1;

//
//if tool_num == 2 then
//F_x_out = A_11 * depth + A_12 * vel + A_13;
//F_z_out = A_21 * depth + A_22 * vel + A_23;
//end;



 implementation_end;
      plug velocity_tool 376 144;
      plug F_x 448 400;
      plug F_z 304 400;
      tool_globals 184 144
       description '<Information><Description><Version>4.0</Version><LibraryPath>Template\Submodel-Equation.emx</LibraryPath><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues><TimeStamp>2007-11-1 22:32:1</TimeStamp><AllowLibraryUpdate>False</AllowLibraryUpdate><Configuration><struct><member><name>DocumentationMask</name><value><struct></struct></value></member></struct></Configuration></Description></Information>';
       type 'Submodel-Equation'
       end;
       implementation eq
/* Equation Submodel
Enter you equations here. You can use the Toolbar buttons at the left ( Add , f(x) etc. ).
*/
parameters
real global depth = 0.05;
real global m_external = 500;
real global tool_num = 0;
real global A_11 = -3183.3;
real global A_12 = -20.9;
real global A_13 = 23.8;
real global A_21 = -1932.0;
real global A_22 = -11.6;
real global A_23 = 89.4;
real global v_init = 0;
real global e_rate = 20;
real global number_of_shears = 1;
real global tool_vel = 1;
real global t1 = 17;
real global t2 = 24;







implementation_end;
     end;
     connections
      external_tool\F_x_out -> F_x;
      external_tool\F_z_out -> F_z;
      velocity_tool -> external_tool\vel;
     end;
    implementation_end;
   Reciever 400 536
    description '<Information><Description><Version>4.0</Version><LibraryPath>Template\Submodel-Equation.emx</LibraryPath><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues><TimeStamp>2007-11-1 22:32:1</TimeStamp><AllowLibraryUpdate>False</AllowLibraryUpdate><Configuration><struct><member><name>DocumentationMask</name><value><struct></struct></value></member></struct></Configuration></Description></Information>';
    type 'Submodel-Equation'
     ports
      signal in Nlfl;
      signal in Nlrr;
      signal in Nlfr;
      signal in Nlrl;
    end;
    icon bg
     figures
      rectangle 363 520 437 552 color 0 fill 15132390;
      text 'name' 400 536 color 0 16;
     terminals
      Nlrr 376 520 fixed;
      Nlfr 416 520 fixed;
      Nlrl 432 520 fixed;
    end;
    implementation eq
/* Equation Submodel
Enter you equations here. You can use the Toolbar buttons at the left ( Add , f(x) etc. ).
*/
variables 
real ab;

equations
  // start typing here
ab = Nlfl*1;
 implementation_end;
   robotti_global 328 368
    description '<Information><Description><Version>4.0</Version><LibraryPath>C:\Program Files\20-sim 4.0\System\Submodel.emx</LibraryPath><TimeStamp>2007-10-31 11:32:54</TimeStamp><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues><AllowLibraryUpdate>True</AllowLibraryUpdate><Configuration><struct><member><name>DocumentationMask</name><value><struct></struct></value></member></struct></Configuration></Description></Information>';
    type Submodel
     ports
      signal in ack_angle;
      signal in delta_r;
      signal in velocity;
      signal out y4_out;
      signal out y3_out;
      signal out y5_out;
      signal in F_x_in;
      signal in F_z_in;
      signal out Nlfl;
      signal out Nlrl;
      signal out Nlfr;
      signal out Nlrr;
      signal out front_left_wheel_speed;
      signal out front_right_wheel_speed;
      signal out d_front_l;
      signal out d_front_r;
    end;
    icon bg shadow 11776947
     figures
      rectangle 199.5 312 456.5 424 color 0 fill 15132390;
      text 'name' 320 368 color 0 16;
     terminals
      ack_angle 352 312 fixed;
      delta_r 384 312 fixed;
      velocity 328 312 fixed;
      y4_out 240 424 fixed;
      y3_out 224 424 fixed;
      y5_out 256 424 fixed;
      F_x_in 248 312 fixed;
      F_z_in 272 312 fixed;
      Nlfl 400 424 fixed;
      Nlrl 432 424 fixed;
      Nlfr 416 424 fixed;
      Nlrr 384 424 fixed;
    end;
    implementation bg
     submodels
      Convert_kinematics 480 192
       description '<Information><Description><Version>4.0</Version><LibraryPath>Template\Submodel-Equation.emx</LibraryPath><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues><TimeStamp>2007-11-1 22:32:1</TimeStamp><AllowLibraryUpdate>False</AllowLibraryUpdate><Configuration><struct><member><name>DocumentationMask</name><value><struct></struct></value></member></struct></Configuration></Description></Information>';
       type 'Submodel-Equation'
        ports
         signal in ack_angle;
         signal in velocity;
         signal out d_front_left;
         signal out d_front_right;
         signal out R_t;
         signal out front_left_wheel_speed;
         signal out front_right_wheel_speed;
       end;
       icon bg
        figures
         rectangle 416 174 544 210 color 0 fill 15132390;
         text 'name' 480 192 color 0 16;
        terminals
         ack_angle 528 176 fixed;
         velocity 432 176 fixed;
         d_front_left 504 208 fixed;
         d_front_right 472 208 fixed;
         R_t 440 208 fixed;
         front_left_wheel_speed 544 200 fixed;
         front_right_wheel_speed 544 184 fixed;
       end;
       implementation eq
/* Equation Submodel
Enter you equations here. You can use the Toolbar buttons at the left ( Add , f(x) etc. ).
*/
// inputs
// v_angular // the steering angle of the (theoretical) center wheel.
// velocity // desired forward velocity

parameters
real global L;
real global T;
real global wheel_radius;
//real global steering_init;
real global s_init[2];
variables 
//real pi;
real omega_c; //
real v_l, v_r; // linear wheel velocity 
real d_inner, d_outer;
//real front_left_wheel_speed, front_right_wheel_speed;
//real R_t; // turning radius
real a_center; // Ackermann angle (assuming small angles) 
// start typing here

equations
	
R_t = L/tan(ack_angle); // turning radius 

a_center = arctan(L/R_t); // a_center

d_inner = arctan(L/(abs(R)-T/2));
d_outer = arctan(L/(abs(R)+T/2));

omega_c = velocity/R_t;

if a_center >= 0 then 
	d_front_left = d_inner;
	d_front_right = d_outer;

	v_l = (abs(R)-T/2)*omega_c;
	v_r = (abs(R)+T/2)*omega_c;

else
	d_front_left = -d_inner;
	d_front_right = -d_outer;

	// Now we can calculate the left and right linear wheel speed [m/s]
   // based on the turning radius and the angular velocity
	v_l = (abs(R)+T/2)*omega_c;  // linear wheel velocity (left)
	v_r = (abs(R)-T/2)*omega_c;
end;	

front_left_wheel_speed = v_l /wheel_radius;
front_right_wheel_speed = v_r /wheel_radius;

implementation_end;
      Demux 424 448
						specifications active 'outputs_8'
							specification 'default'
description '<Description>
   <Version>4.1</Version>
  <LibraryPath>Signal\Block Diagram\Demux.emx</LibraryPath>
  <TimeStamp>2011-10-5 22:44:58</TimeStamp>
<IsMainModel>1</IsMainModel>
 <KeepParameterValues>False</KeepParameterValues>
 <AllowLibraryUpdate>True</AllowLibraryUpdate>
</Description>';
 type Demux
  ports
   signal out output1;
   signal in input [2,1];
   signal out output2;
 end;
 icon bg bottom
  figures
   line 129.5 64 129.5 96 width 2;
   rectangle 125.5 64 133.5 96 color -1;
   text '2' 134.5 91 color 8421504 8;
  terminals
   output1 129.5 72 fixed;
   input 129.5 80 fixed;
   output2 129.5 88 fixed;
 end;
 implementation eq
equations
	[output1; output2] = input;implementation_end;
specification_end;
							specification 'outputs_1'
description '<Description>
   <Version>4.1</Version>
  <LibraryPath>Signal\Block Diagram\Demux.emx</LibraryPath>
  <TimeStamp>2011-3-4 15:12:50</TimeStamp>
<IsMainModel>1</IsMainModel>
 <KeepParameterValues>False</KeepParameterValues>
 <AllowLibraryUpdate>True</AllowLibraryUpdate>
</Description>';
 type Demux
  ports
   signal out output;
   signal in input;
 end;
 icon bg bottom
  figures
   line 128 64 128 80 width 2;
   rectangle 124 64 132 80 color -1;
   text '1' 133 82 color 8421504 8;
  terminals
   input 128 72 fixed;
   output 128 72 fixed;
 end;
 implementation eq
equations
	output = input;implementation_end;
specification_end;
							specification 'outputs_2'
description '<Description>
   <Version>4.1</Version>
  <LibraryPath>Signal\Block Diagram\Demux.emx</LibraryPath>
  <TimeStamp>2011-3-4 15:12:50</TimeStamp>
<IsMainModel>1</IsMainModel>
 <KeepParameterValues>False</KeepParameterValues>
 <AllowLibraryUpdate>True</AllowLibraryUpdate>
</Description>';
 type Demux
  ports
   signal out output1;
   signal in input [2,1];
   signal out output2;
 end;
 icon bg bottom
  figures
   line 128 56 128 88 width 2;
   rectangle 124 56 132 88 color -1;
   text '2' 133 83 color 8421504 8;
  terminals
   output1 128 64 fixed;
   input 128 72 fixed;
   output2 128 80 fixed;
 end;
 implementation eq
equations
	[output1; output2] = input;implementation_end;
specification_end;
							specification 'outputs_3'
description '<Description>
   <Version>4.1</Version>
  <LibraryPath>Signal\Block Diagram\Demux.emx</LibraryPath>
  <TimeStamp>2011-3-4 15:12:50</TimeStamp>
<IsMainModel>1</IsMainModel>
 <KeepParameterValues>False</KeepParameterValues>
 <AllowLibraryUpdate>True</AllowLibraryUpdate>
</Description>';
 type Demux
  ports
   signal out output1;
   signal out output2;
   signal out output3;
   signal in input [3,1];
 end;
 icon bg bottom
  figures
   line 128 56 128 88 width 2;
   rectangle 124 56 132 88 color -1;
   text '3' 133 82 color 8421504 8;
  terminals
   output1 128 64 fixed;
   output2 128 72 fixed;
   output3 128 80 fixed;
   input 128 72 fixed;
 end;
 implementation eq
equations
	[output1; output2; output3] = input;implementation_end;
specification_end;
							specification 'outputs_4'
description '<Description>
   <Version>4.1</Version>
  <LibraryPath>Signal\Block Diagram\Demux.emx</LibraryPath>
  <TimeStamp>2011-3-4 15:12:50</TimeStamp>
<IsMainModel>1</IsMainModel>
 <KeepParameterValues>False</KeepParameterValues>
 <AllowLibraryUpdate>True</AllowLibraryUpdate>
</Description>';
 type Demux
  ports
   signal out robot_beta;
   signal out robot_x;
   signal out robot_y;
   signal out robot_w;
   signal out robot_theta;
   signal out robot_v;
   signal out w_c_w;
   signal out w_c_p;
   signal in input [8,1];
 end;
 icon bg right
  figures
   line 356 97 312 97 color 0 width 2;
   text '4' 341 103 color 8421504 8;
  terminals
   robot_x 320 96 fixed;
   robot_y 328 96 fixed;
   robot_w 344 96 fixed;
   robot_theta 352 96 fixed;
   input 336 96 fixed;
 end;
 implementation eq
equations
	[robot_x; robot_y; robot_w; robot_theta; robot_beta; robot_v; w_c_w; w_c_p ] = input;implementation_end;
specification_end;
							specification 'outputs_5'
description '<Description>
   <Version>4.1</Version>
  <LibraryPath>Signal\Block Diagram\Demux.emx</LibraryPath>
  <TimeStamp>2011-3-4 15:12:50</TimeStamp>
<IsMainModel>1</IsMainModel>
 <KeepParameterValues>False</KeepParameterValues>
 <AllowLibraryUpdate>True</AllowLibraryUpdate>
</Description>';
 type Demux
  ports
   signal out output1;
   signal out output2;
   signal out output3;
   signal out output4;
   signal out output5;
   signal in input [5,1];
 end;
 icon bg right
  figures
   line 312 96 360 96 color 0 width 2;
   rectangle 312 92 360 100 color -1;
   text '5' 347 91 color 8421504 8;
  terminals
   output1 320 96 fixed;
   output2 328 96 fixed;
   output3 336 96 fixed;
   output4 344 96 fixed;
   output5 352 96 fixed;
   input 336 96 fixed;
 end;
 implementation eq
equations
	[robot_x; robot_y; robot_w; robot_theta; robot_v] = input;implementation_end;
specification_end;
							specification 'outputs_6'
description '<Description>
   <Version>4.1</Version>
  <LibraryPath>Signal\Block Diagram\Demux.emx</LibraryPath>
  <TimeStamp>2011-3-4 15:12:50</TimeStamp>
<IsMainModel>1</IsMainModel>
 <KeepParameterValues>False</KeepParameterValues>
 <AllowLibraryUpdate>True</AllowLibraryUpdate>
</Description>';
 type Demux
  ports
   signal out output1;
   signal out output2;
   signal out output3;
   signal out output4;
   signal out output5;
   signal out output6;
   signal in input [6,1];
 end;
 icon bg bottom
  figures
   line 128 40 128 104 width 2;
   rectangle 124 40 132 104 color -1;
   text '6' 133 83 color 8421504 8;
  terminals
   output1 128 48 fixed;
   output2 128 56 fixed;
   output3 128 64 fixed;
   output4 128 80 fixed;
   output5 128 88 fixed;
   output6 128 96 fixed;
   input 128 72 fixed;
 end;
 implementation eq
equations
	[output1; output2; output3; output4; output5; output6] = input;implementation_end;
specification_end;
							specification 'outputs_7'
description '<Description>
   <Version>4.1</Version>
  <LibraryPath>Signal\Block Diagram\Demux.emx</LibraryPath>
  <TimeStamp>2011-3-4 15:12:50</TimeStamp>
<IsMainModel>1</IsMainModel>
 <KeepParameterValues>False</KeepParameterValues>
 <AllowLibraryUpdate>True</AllowLibraryUpdate>
</Description>';
 type Demux
  ports
   signal out output1;
   signal out output2;
   signal out output3;
   signal out output4;
   signal out output5;
   signal out output6;
   signal out output7;
   signal in input [7,1];
 end;
 icon bg bottom
  figures
   line 128 40 128 104 width 2;
   rectangle 124 40 132 104 color -1;
   text '7' 133 83 color 8421504 8;
  terminals
   output1 128 48 fixed;
   output2 128 56 fixed;
   output3 128 64 fixed;
   output4 128 72 fixed;
   output5 128 80 fixed;
   output6 128 88 fixed;
   output7 128 96 fixed;
   input 128 72 fixed;
 end;
 implementation eq
equations
	[output1; output2; output3; output4; output5; output6; output7] = input;implementation_end;
specification_end;
							specification 'outputs_8'
 description '<Description>
   <Version>4.1</Version>
  <LibraryPath>Signal\Block Diagram\Demux.emx</LibraryPath>
  <TimeStamp>2011-3-4 15:12:50</TimeStamp>
<IsMainModel>1</IsMainModel>
 <KeepParameterValues>False</KeepParameterValues>
 <AllowLibraryUpdate>True</AllowLibraryUpdate>
</Description>';
 type Demux
  ports
   signal out y1;
   signal out y2;
   signal out y3;
   signal out y4;
   signal out y5;
   signal out y6;
   signal out y7;
   signal out y8;
   signal in input [13,1];
   signal out y9;
   signal out Nlfl;
   signal out Nlfr;
   signal out Nlrl;
   signal out Nlrr;
 end;
 icon bg right
  figures
   line 384 448 464 448 color 0 width 2;
   rectangle 384 444 464 452 color -1;
   text '8' 435 443 color 8421504 8;
  terminals
   y1 392 448 fixed;
   y2 400 448 fixed;
   y3 408 448 fixed;
   y4 416 448 fixed;
   y5 432 448 fixed;
   y6 440 448 fixed;
   y7 448 448 fixed;
   y8 456 448 fixed;
   input 424 448 fixed;
 end;
 implementation eq
equations
	[y1;y2;y3;y4;y5;y6;y7;y8;y9;Nlfl;Nlfr;Nlrl;Nlrr] = input;implementation_end;
specification_end;
							specification 'outputs_9'
description '<Description>
   <Version>4.1</Version>
  <LibraryPath>Signal\Block Diagram\Demux.emx</LibraryPath>
  <TimeStamp>2011-3-4 15:12:50</TimeStamp>
<IsMainModel>1</IsMainModel>
 <KeepParameterValues>False</KeepParameterValues>
 <AllowLibraryUpdate>True</AllowLibraryUpdate>
</Description>';
 type Demux
  ports
   signal out output1;
   signal out output2;
   signal out output3;
   signal out output4;
   signal out output5;
   signal out output6;
   signal out output7;
   signal out output8;
   signal out output9;
   signal in input [9,1];
 end;
 icon bg bottom
  figures
   line 128 32 128 112 width 2;
   text '9' 132 83 color 8421504 8;
  terminals
   output1 128 40 fixed;
   output2 128 48 fixed;
   output3 128 56 fixed;
   output4 128 64 fixed;
   output5 128 72 fixed;
   output6 128 80 fixed;
   output7 128 88 fixed;
   output8 128 96 fixed;
   output9 128 104 fixed;
   input 128 72 fixed;
 end;
 implementation eq
equations
	[output1; output2; output3; output4; output5; output6; output7; output8; output9] = input;implementation_end;
specification_end;
						end;
      Global_values 112 88
       description '<Information><Description><Version>4.0</Version><LibraryPath>Template\Submodel-Equation.emx</LibraryPath><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues><TimeStamp>2007-11-1 22:32:1</TimeStamp><AllowLibraryUpdate>False</AllowLibraryUpdate><Configuration><struct><member><name>DocumentationMask</name><value><struct></struct></value></member></struct></Configuration></Description></Information>';
       type 'Submodel-Equation'
       end;
       implementation eq
/* Equation Submodel
Enter you equations here. You can use the Toolbar buttons at the left ( Add , f(x) etc. ).
*/
parameters
real global y_init[9] = [0;0;0;0;0;0;0;0.01;0];
real global s_init[2] = [0;0];
//real global y0 = [0;0;0;0;0;0;0;u;0]      # Initial Conditions
real global m_robot = 1000; // [kg]
real global T = 2; // [m] Trackwidth
real global L = 2; // [m] Wheel base
real global cAlphaF = 38323.06343; // cornering stiffness Front
real global cAlphaR = 38323.06343; // cornering stiffness Front
real global front_to_rear_ratio = 0.5; // 
real global lr_ratio = 0.5; //0.9 meaning 90% on the left and 10% on the right 
real global mu = 0.6; // surface firction
real global if_non = 0; // use nonlinear tire-model 
real global h = 1;
real global wheel_radius = 0.296; // wheel radius [FFO: get back to this]

//real global m_ext = 500; // external load
real global l_ext = 1.5; // length to external load
real global steering_angle = 0.034905; // 2 degree
implementation_end;
      plug velocity 336 64;
      plug y4_out 376 560;
      plug y3_out 272 504;
      plug y5_out 440 560;
      plug F_x_in 232 200;
      plug F_z_in 184 200;
      plug Nlrl 592 616;
      plug Nlfr 552 616;
      plug Nlrr 512 616;
      plug front_left_wheel_speed 728 208;
      plug front_right_wheel_speed 736 184;
      plug d_front_l 696 256;
      plug d_front_r 696 232;
      plug delta_r 272 64;
      plug Nlfl 632 616;
      plug ack_angle 536 64;
      Robotti_model 408 344
       description '<Information><Description><Version>4.0</Version><LibraryPath>Template\Submodel-Equation.emx</LibraryPath><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues><TimeStamp>2007-11-1 22:32:1</TimeStamp><AllowLibraryUpdate>False</AllowLibraryUpdate><Configuration><struct><member><name>DocumentationMask</name><value><struct></struct></value></member></struct></Configuration></Description></Information>';
       type 'Submodel-Equation'
        ports
         signal in delta_fl;
         signal in delta_r;
         signal in u_r;
         signal out y_out [13,1];
         signal in F_x_in;
         signal in F_z_in;
         signal in delta_fr;
         signal in R_t;
       end;
       icon bg
        figures
         rectangle 235.5 284 580.5 404 color 0 fill 15132390;
         text 'name' 416 336 color 0 16;
        terminals
         delta_fl 552 280 fixed;
         delta_r 344 280 fixed;
         u_r 392 280 fixed;
         y_out 424 408 fixed;
         F_x_in 288 280 fixed;
         F_z_in 264 280 fixed;
         delta_fr 528 280 fixed;
         R_t 432 280 fixed;
       end;
       implementation eq
/* Standard vehicle model
Frederik Forchhammer Foldager
ffo@eng.au.dk
\ last edited - 16/05 2018
*/
parameters
real global m_robot;
real global T;
real global L;
real global front_to_rear_ratio, lr_ratio; 
real global cAlphaF, cAlphaR;
real global y_init[9];
real global mu, if_non;	
real global l_ext;
real global h;

variables
real Izz;
real y1, ydot_1, y2, ydot_2,y3, ydot_3, y4, ydot_4,y5, ydot_5;
real y6, ydot_6, y7, ydot_7,y8, y9, ydot_9;// ydot_8;
real alphaFl, alphaFr, alphaRl, alphaRr;
real FyflT, FyfrT, FyrlT, FyrrT;
real Fyfl, Fyfr, Fyrl, Fyrr;
real sum_Fyf, sum_Fyr;
real a, b;
real Nlfl, Nlfr, Nlrl, Nlrr;
real M_ext;
real m_ext_l, m_ext_r;
real m_robot_l, m_robot_r;
real g;
real m_total;
real deltaFl, deltaFr, deltaRl, deltaRr;
real m_ext, m_robot_in;
real beta;
real df_kin;

		
equations // equations 
if T > 2.5 then
	m_robot_in = m_robot*1;
end;
if T < 2.5 then
	m_robot_in = m_robot*0.9;
	if T == 0.9 then
	m_robot_in = m_robot*0.8;
	end;
end;	


g = 9.81;
m_ext = F_z_in/9.81;
m_total = m_robot_in+m_ext;
Izz = m_total/12*(T^2+L^2);
a = L*front_to_rear_ratio;
b = L*(1-front_to_rear_ratio);

m_ext_l = m_ext *0.5;
m_ext_r = m_ext *0.5;
m_robot_l = m_robot_in*(1-lr_ratio);
m_robot_r = m_robot_in*(lr_ratio);
M_ext = - m_ext_l * g * (l_ext);


deltaFl = delta_fl;
deltaFr = delta_fr;

deltaRl = 0;
deltaRr = 0;

Nlrl = (a*m_robot_l*g - M_ext) / L; // Normal load rear left
Nlrr = m_robot_r*g*(a/L); // Normal load on the rear right
Nlfr = m_robot_r*g*(b/L)+m_ext_r*g; // Normal load on the rear right

if (l_ext <= L) then
	Nlfl = 1/L*(m_robot_l*g*b+m_ext_l*g*(L-l_ext)-h*F_x_in);
else
	Nlfl = 1/L * (m_robot_l*g*b-m_ext_l*g*(l_ext-L)-h*F_x_in);
end;

//Nlfl = Nlf * l_r_ratio; 		// Normal load front left
//Nlfr = Nlf * (1-l_r_ratio);	// Normal load front right
//Nlrl = Nlr * l_r_ratio;			// 
//Nlrr = Nlr * (1-l_r_ratio);	// Normal load rear right

 

// and here we perform the integration



 //yaw dynamics
//y1 = int(ydot_1)+y_init[1];


// relevant for kinematics
df_kin = arctan(L/R_t);

beta = b/(a+b)*arctan(df_kin);


alphaFl=arctan((y2+ a*y1) / (y8+(( T/2) * y1)))-deltaFl; 
alphaFr=arctan((y2+ a*y1) / (y8-(( T/2) * y1)))-deltaFr;
alphaRl=arctan((y2- a*y1) / (y8+(( T/2) * y1)))-deltaRl;
alphaRr=arctan((y2- a*y1) / (y8-(( T/2) * y1)))-deltaRr;


if (if_non == 0) then
	FyflT = -cAlphaF*tan(alphaFl); 
	FyfrT = -cAlphaF*tan(alphaFr);
	FyrlT = -cAlphaR*tan(alphaRl);
	FyrrT = -cAlphaR*tan(alphaRr);
else
	FyflT = -cAlphaF*tan(alphaFl); // front left nonlinear model
   	if abs(FyflT) > mu*Nlfl/2 then
        	FyflT = -mu*Nlfl*sign(alphaFl)*(1-(mu*Nlfl) / (4*cAlphaF*abs(tan(alphaFl))));          
   	else
        	FyflT = -cAlphaF*tan(alphaFl);
		end;
	FyfrT = -cAlphaF*tan(alphaFr); //front right nonlinear model
   	if abs(FyfrT) > mu*Nlfr/2 then
        	FyfrT = -mu*Nlfr*sign(alphaFr)*(1-(mu*Nlfr) / (4*cAlphaF*abs(tan(alphaFr))));          
   	else
        	FyfrT = -cAlphaF*tan(alphaFr);	
		end;
	FyrlT = -cAlphaF*tan(alphaRl); // rear left nonlinear model
   	if abs(FyrlT) > mu*Nlrl/2 then
        	FyrlT = -mu*Nlrl*sign(alphaRl)*(1-(mu*Nlrl) / (4*cAlphaR*abs(tan(alphaRl))));          
   	else
        	FyrlT = -cAlphaR*tan(alphaRl);
		end;
	FyrrT = -cAlphaR*tan(alphaRr); // rear right
   	if abs(FyrrT) > mu*Nlrr/2 then
        	FyrrT = -mu*Nlrr*sign(alphaRr)*(1-(mu*Nlrr) / (4*cAlphaR*abs(tan(alphaRr))));          
   	else
        	FyrrT = -cAlphaR*tan(alphaRr);
		end;
end;

Fyfl=FyflT*cos(deltaFl)+0*sin(deltaFl); 
Fyfr=FyfrT*cos(deltaFr)+0*sin(deltaFr);
Fyrl=FyrlT*cos(deltaRl)+0*sin(deltaRl);
Fyrr=FyrrT*cos(deltaRr)+0*sin(deltaRr);

sum_Fyf = Fyfl + Fyfr;
sum_Fyr = Fyrl + Fyrr; 	


// here we need to put in a criteria for thosing either the dynamic 4 wheel model of the kinematic model
if u_r > 1 then
	ydot_1 = 1.0/Izz * (sum_Fyf*a-sum_Fyr*b); //yaw dynamics
	ydot_2 = 1.0/m_total * (sum_Fyf+sum_Fyr) - y8*y1; //lateral dynamics
	ydot_3 = y8*cos(y5)-y2*sin(y5); 
	ydot_4 = y8*sin(y5)+y2*cos(y5);
	ydot_5 = y1;
	ydot_6 = y7;
	ydot_7 = 0;
	ydot_9 = 0;
else
	ydot_1 = u_r/b*sin(beta); 
	ydot_2 = 0;
	ydot_3 = u_r*cos(y1+beta); 
	ydot_4 = u_r*sin(y1+beta); 
	ydot_5 = 0;
	ydot_6 = 0;
	ydot_7 = 0;
	ydot_9 = 0;


end;
y1 = int(ydot_1)+y_init[1];
y2 = int(ydot_2)+y_init[2];
y3 = int(ydot_3)+y_init[3]; //x_position;
y4 = int(ydot_4)+y_init[4]; //Y_position;
y5 = int(ydot_5)+y_init[5]; 
y6 = int(ydot_6)+y_init[6];
y7 = int(ydot_7)+y_init[7]; 
//ydot_8 = y2*y1;
//y8 = int(ydot_8)+y_init[8];	// forward velocity
y8 = u_r;
y9 = int(ydot_9)+y_init[9];


//end;


y_out = [y1; y2; y3; y4; y5; y6; y7; y8; y9; Nlfl; Nlfr; Nlrl; Nlrr];


//delta_fd = delta_f; // note: find ud af noget her. 
implementation_end;
      Splitter1 352 136
       description '<Description><Version>4.0</Version>
   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>
  <TimeStamp>2008-01-17 11:28:29</TimeStamp>
<IsMainModel>1</IsMainModel>
 <KeepParameterValues>False</KeepParameterValues>
</Description>';
       knot Splitter
        ports
         signal knot duplicatable out output [1];
         signal knot in input [1];
       end;
       icon bg ellipse
        figures
         ellipse 348.8 132.8 355.2 139.2 color -1 fill 0;
         ellipse 347.7 131.7 356.3 140.3 color -1;
        terminals
         input 352 136 fixed;
       end;
       implementation eq
equations
    collect (output) = input;
implementation_end;
      Splitter2 536 256
       description '<Description><Version>4.0</Version>
   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>
  <TimeStamp>2008-01-17 11:28:29</TimeStamp>
<IsMainModel>1</IsMainModel>
 <KeepParameterValues>False</KeepParameterValues>
</Description>';
       knot Splitter
        ports
         signal knot duplicatable out output [1];
         signal knot in input [1];
       end;
       icon bg ellipse
        figures
         ellipse 532.8 252.8 539.2 259.2 color -1 fill 0;
         ellipse 531.7 251.7 540.3 260.3 color -1;
        terminals
         input 536 256 fixed;
       end;
       implementation eq
equations
    collect (output) = input;
implementation_end;
      Splitter3 488 232
       description '<Description><Version>4.0</Version>
   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>
  <TimeStamp>2008-01-17 11:28:29</TimeStamp>
<IsMainModel>1</IsMainModel>
 <KeepParameterValues>False</KeepParameterValues>
</Description>';
       knot Splitter
        ports
         signal knot duplicatable out output [1];
         signal knot in input [1];
       end;
       icon bg ellipse
        figures
         ellipse 484.8 228.8 491.2 235.2 color -1 fill 0;
         ellipse 483.7 227.7 492.3 236.3 color -1;
        terminals
         input 488 232 fixed;
       end;
       implementation eq
equations
    collect (output) = input;
implementation_end;
     end;
     connections
      ack_angle -> Convert_kinematics\ack_angle;
      Convert_kinematics\d_front_left -> Splitter2\input;
      Convert_kinematics\d_front_right -> Splitter3\input;
      Convert_kinematics\front_left_wheel_speed -> front_left_wheel_speed;
      Convert_kinematics\front_right_wheel_speed -> front_right_wheel_speed;
      Convert_kinematics\R_t -> Robotti_model\R_t;
      delta_r -> Robotti_model\delta_r;
      Demux\Nlfl -> Nlfl;
      Demux\Nlfr -> Nlfr;
      Demux\Nlrl -> Nlrl;
      Demux\Nlrr -> Nlrr;
      Demux\y3 -> y3_out;
      Demux\y4 -> y4_out;
      Demux\y5 -> y5_out;
      F_x_in -> Robotti_model\F_x_in;
      F_z_in -> Robotti_model\F_z_in;
      Robotti_model\y_out -> Demux\input;
      Splitter1\output -> Convert_kinematics\velocity;
      Splitter1\output -> Robotti_model\u_r;
      Splitter2\output -> d_front_l;
      Splitter2\output -> Robotti_model\delta_fl;
      Splitter3\output -> d_front_r;
      Splitter3\output -> Robotti_model\delta_fr;
      velocity -> Splitter1\input;
     end;
    implementation_end;
   Splitter1 296 200
    description '<Description><Version>4.0</Version>
   <LibraryPath>Signal\Block Diagram\Splitter.emx</LibraryPath>
  <TimeStamp>2008-01-17 11:28:29</TimeStamp>
<IsMainModel>1</IsMainModel>
 <KeepParameterValues>False</KeepParameterValues>
</Description>';
    knot Splitter
     ports
      signal knot duplicatable out output [1];
      signal knot in input [1];
    end;
    icon bg ellipse
     figures
      ellipse 292.8 196.8 299.2 203.2 color -1 fill 0;
      ellipse 291.7 195.7 300.3 204.3 color -1;
     terminals
      input 296 200 fixed;
    end;
    implementation eq
equations
    collect (output) = input;
implementation_end;
   Steering_input 360 160
    description '<Information><Description><Version>4.0</Version><LibraryPath>Template\Submodel-Equation.emx</LibraryPath><IsMainModel>1</IsMainModel><KeepParameterValues>False</KeepParameterValues><TimeStamp>2007-11-1 22:32:1</TimeStamp><AllowLibraryUpdate>False</AllowLibraryUpdate><Configuration><struct><member><name>DocumentationMask</name><value><struct></struct></value></member></struct></Configuration></Description></Information>';
    type 'Submodel-Equation'
     ports
      signal out ack_angle;
      signal out des_vel;
      signal out delta_r;
    end;
    icon bg
     figures
      rectangle 312 143 408 177 color 0 fill 15132390;
      text 'name' 360 152 color 0 16;
    end;
    implementation eq
/* Equation Submodel
Enter you equations here. You can use the Toolbar buttons at the left ( Add , f(x) etc. ).
*/
parameters
real global steering_angle;
real global y_init[9];
//real global steering_init;


 
//real steering_rate_in;
equations

if time < 4 then
ack_angle = steering_angle;
des_vel = y_init[8];
else 
ack_angle = -steering_angle;
des_vel = y_init[8]*150;      // this was a test to see how the model behaved under low and "high" velocity

end;



//delta_front_r = out_r;

delta_r = 0;
implementation_end;
  end;
  connections
   external_tool_global\F_x -> robotti_global\F_x_in 224 288;
   external_tool_global\F_z -> robotti_global\F_z_in 232 248;
   robotti_global\Nlfl -> Reciever\Nlfl;
   robotti_global\Nlfr -> Reciever\Nlfr;
   robotti_global\Nlrl -> Reciever\Nlrl;
   robotti_global\Nlrr -> Reciever\Nlrr;
   Splitter1\output -> external_tool_global\velocity_tool 176 176;
   Splitter1\output -> robotti_global\velocity;
   Steering_input\ack_angle -> robotti_global\ack_angle;
   Steering_input\delta_r -> robotti_global\delta_r;
   Steering_input\des_vel -> Splitter1\input;
  end;
 implementation_end;
]]>
</Sidops>
 </Model>
 <Experiments>
     <DefaultExperiment><![CDATA[Experiment 1]]>
</DefaultExperiment>
  <Experiment>
    <Name>Experiment 1</Name>
    <CreatedBy></CreatedBy>
    <Info></Info>
<ExpData>
  <VersionNumber>4.7</VersionNumber>
  <ModelProperties>
    <ModelProperty section="CCodeDialog" entry="SubmodelName" value="external_tool_global"/>
    <ModelProperty section="CCodeDialog" entry="TargetName" value="FMU 2.0 export for 20-sim submodel (GitHub)"/>
    <ModelProperty section="CCodeDialog" entry="TargetDirectory" value="c:\temp\%SUBMODEL_NAME%_tool_3"/>
  </ModelProperties>
  <Variables>
   <Constants>
   </Constants>
   <Parameters>
   </Parameters>
   <Initials>
    <Variable>
     <Name>robotti_global\Robotti_model\ydot_1_int_initial</Name>
     <Value>0</Value>
    </Variable>
    <Variable>
     <Name>robotti_global\Robotti_model\ydot_2_int_initial</Name>
     <Value>0</Value>
    </Variable>
    <Variable>
     <Name>robotti_global\Robotti_model\ydot_3_int_initial</Name>
     <Value>0</Value>
    </Variable>
    <Variable>
     <Name>robotti_global\Robotti_model\ydot_4_int_initial</Name>
     <Value>0</Value>
    </Variable>
    <Variable>
     <Name>robotti_global\Robotti_model\ydot_5_int_initial</Name>
     <Value>0</Value>
    </Variable>
    <Variable>
     <Name>robotti_global\Robotti_model\ydot_6_int_initial</Name>
     <Value>0</Value>
    </Variable>
    <Variable>
     <Name>robotti_global\Robotti_model\ydot_7_int_initial</Name>
     <Value>0</Value>
    </Variable>
    <Variable>
     <Name>robotti_global\Robotti_model\ydot_9_int_initial</Name>
     <Value>0</Value>
    </Variable>
   </Initials>
  </Variables>
  <PlotSpecs>
   <VarNames>
    <VarName>time</VarName>
    <VarName>robotti_global\Demux\y3</VarName>
    <VarName>robotti_global\Robotti_model\y4</VarName>
    <VarName>robotti_global\Robotti_model\Nlfl</VarName>
    <VarName>robotti_global\Robotti_model\Nlfr</VarName>
    <VarName>robotti_global\Robotti_model\Nlrl</VarName>
    <VarName>robotti_global\Robotti_model\Nlrr</VarName>
    <VarName>external_tool_global\external_tool\vel</VarName>
    <VarName>robotti_global\Convert_kinematics\d_front_left</VarName>
    <VarName>robotti_global\Convert_kinematics\d_front_right</VarName>
    <VarName>robotti_global\Robotti_model\u_r</VarName>
   </VarNames>
   <Plots>
    <Plot>
     <PlotType>GraphPlot</PlotType>
     <BasePlot>
       <PlotId>1</PlotId>
       <UseWindowsBGColor>true</UseWindowsBGColor>
       <BGColor>15790320</BGColor>
       <PlotIsVisible>true</PlotIsVisible>
     </BasePlot>
     <Grid>
      <DrawGrid>true</DrawGrid>
      <GridColor>15780518</GridColor>
      <XTicks>10</XTicks>
      <YTicks>10</YTicks>
      <ZTicks>10</ZTicks>
      <Use3DLook>false</Use3DLook>
     </Grid>
     <PlotBGColor>16777215</PlotBGColor>
     <ShowPlotTitle>false</ShowPlotTitle>
     <TitlePosition>1</TitlePosition>
     <PlotTitle>y_out[1,3]</PlotTitle>
     <ShowXValues>true</ShowXValues>
     <Fonts>
      <TitleFont>
       <Name>Arial</Name>
       <Height>12</Height>
       <PitchFamily>34</PitchFamily>
       <Weight>400</Weight>
       <Italic>0</Italic>
       <UnderLine>0</UnderLine>
       <StrikeOut>0</StrikeOut>
       <Color>0</Color>
      </TitleFont>
      <LabelFont>
       <Name>Arial</Name>
       <Height>12</Height>
       <PitchFamily>34</PitchFamily>
       <Weight>400</Weight>
       <Italic>0</Italic>
       <UnderLine>0</UnderLine>
       <StrikeOut>0</StrikeOut>
       <Color>0</Color>
      </LabelFont>
      <ValuesFont>
       <Name>Arial</Name>
       <Height>10</Height>
       <PitchFamily>34</PitchFamily>
       <Weight>400</Weight>
       <Italic>0</Italic>
       <UnderLine>0</UnderLine>
       <StrikeOut>0</StrikeOut>
       <Color>0</Color>
      </ValuesFont>
     </Fonts>
     <SharedXAxis>true</SharedXAxis>
     <SharedYAxis>true</SharedYAxis>
     <SharedZAxis>false</SharedZAxis>
     <XAxes>
      <Axis>
       <Minimum>0</Minimum>
       <Maximum>40</Maximum>
       <Linear>true</Linear>
       <Scaling>3</Scaling>
       <Label>time</Label>
      </Axis>
     </XAxes>
     <YAxes>
      <Axis>
       <Minimum>-500</Minimum>
       <Maximum>4500</Maximum>
       <Linear>true</Linear>
       <Scaling>1</Scaling>
       <Label>Nlfl</Label>
      </Axis>
      <Axis>
       <Minimum>0</Minimum>
       <Maximum>10</Maximum>
       <Linear>true</Linear>
       <Scaling>1</Scaling>
       <Label>Nlfr</Label>
      </Axis>
      <Axis>
       <Minimum>0</Minimum>
       <Maximum>10</Maximum>
       <Linear>true</Linear>
       <Scaling>1</Scaling>
       <Label>Nlrl</Label>
      </Axis>
      <Axis>
       <Minimum>0</Minimum>
       <Maximum>10</Maximum>
       <Linear>true</Linear>
       <Scaling>1</Scaling>
       <Label>Nlrr</Label>
      </Axis>
     </YAxes>
     <ZAxes>
     </ZAxes>
     <Curves>
      <Curve>
       <LineColor>16711680</LineColor>
       <LineStyle>1</LineStyle>
       <TickColor>16711680</TickColor>
       <TickStyle>0</TickStyle>
       <CurveVisible>true</CurveVisible>
       <PixelThresshold>1</PixelThresshold>
       <LineThickness>1</LineThickness>
       <LineOrder>1</LineOrder>
       <ShowYValues>true</ShowYValues>
       <XCurveData>
        <ShowUnit>true</ShowUnit>
        <VarName>time</VarName>
       </XCurveData>
       <YCurveData>
        <ShowUnit>true</ShowUnit>
        <VarName>robotti_global\Robotti_model\Nlfl</VarName>
       </YCurveData>
      </Curve>
      <Curve>
       <LineColor>16711935</LineColor>
       <LineStyle>1</LineStyle>
       <TickColor>16711935</TickColor>
       <TickStyle>0</TickStyle>
       <CurveVisible>true</CurveVisible>
       <PixelThresshold>1</PixelThresshold>
       <LineThickness>1</LineThickness>
       <LineOrder>1</LineOrder>
       <ShowYValues>true</ShowYValues>
       <XCurveData>
        <ShowUnit>true</ShowUnit>
        <VarName>time</VarName>
       </XCurveData>
       <YCurveData>
        <ShowUnit>true</ShowUnit>
        <VarName>robotti_global\Robotti_model\Nlfr</VarName>
       </YCurveData>
      </Curve>
      <Curve>
       <LineColor>255</LineColor>
       <LineStyle>1</LineStyle>
       <TickColor>255</TickColor>
       <TickStyle>0</TickStyle>
       <CurveVisible>true</CurveVisible>
       <PixelThresshold>1</PixelThresshold>
       <LineThickness>1</LineThickness>
       <LineOrder>1</LineOrder>
       <ShowYValues>true</ShowYValues>
       <XCurveData>
        <ShowUnit>true</ShowUnit>
        <VarName>time</VarName>
       </XCurveData>
       <YCurveData>
        <ShowUnit>true</ShowUnit>
        <VarName>robotti_global\Robotti_model\Nlrl</VarName>
       </YCurveData>
      </Curve>
      <Curve>
       <LineColor>65280</LineColor>
       <LineStyle>1</LineStyle>
       <TickColor>65280</TickColor>
       <TickStyle>0</TickStyle>
       <CurveVisible>true</CurveVisible>
       <PixelThresshold>1</PixelThresshold>
       <LineThickness>1</LineThickness>
       <LineOrder>1</LineOrder>
       <ShowYValues>true</ShowYValues>
       <XCurveData>
        <ShowUnit>true</ShowUnit>
        <VarName>time</VarName>
       </XCurveData>
       <YCurveData>
        <ShowUnit>true</ShowUnit>
        <VarName>robotti_global\Robotti_model\Nlrr</VarName>
       </YCurveData>
      </Curve>
     </Curves>
     <Legenda>
      <ShowLegenda>true</ShowLegenda>
     </Legenda>
    </Plot>
    <Plot>
     <PlotType>GraphPlot</PlotType>
     <BasePlot>
       <PlotId>2</PlotId>
       <UseWindowsBGColor>true</UseWindowsBGColor>
       <BGColor>15790320</BGColor>
       <PlotIsVisible>true</PlotIsVisible>
     </BasePlot>
     <Grid>
      <DrawGrid>true</DrawGrid>
      <GridColor>15780518</GridColor>
      <XTicks>10</XTicks>
      <YTicks>10</YTicks>
      <ZTicks>10</ZTicks>
      <Use3DLook>false</Use3DLook>
     </Grid>
     <PlotBGColor>16777215</PlotBGColor>
     <ShowPlotTitle>false</ShowPlotTitle>
     <TitlePosition>1</TitlePosition>
     <PlotTitle>y_out[1,4]</PlotTitle>
     <ShowXValues>true</ShowXValues>
     <Fonts>
      <TitleFont>
       <Name>Arial</Name>
       <Height>12</Height>
       <PitchFamily>34</PitchFamily>
       <Weight>400</Weight>
       <Italic>0</Italic>
       <UnderLine>0</UnderLine>
       <StrikeOut>0</StrikeOut>
       <Color>0</Color>
      </TitleFont>
      <LabelFont>
       <Name>Arial</Name>
       <Height>12</Height>
       <PitchFamily>34</PitchFamily>
       <Weight>400</Weight>
       <Italic>0</Italic>
       <UnderLine>0</UnderLine>
       <StrikeOut>0</StrikeOut>
       <Color>0</Color>
      </LabelFont>
      <ValuesFont>
       <Name>Arial</Name>
       <Height>10</Height>
       <PitchFamily>34</PitchFamily>
       <Weight>400</Weight>
       <Italic>0</Italic>
       <UnderLine>0</UnderLine>
       <StrikeOut>0</StrikeOut>
       <Color>0</Color>
      </ValuesFont>
     </Fonts>
     <SharedXAxis>true</SharedXAxis>
     <SharedYAxis>true</SharedYAxis>
     <SharedZAxis>false</SharedZAxis>
     <XAxes>
      <Axis>
       <Minimum>-9.30752309475855</Minimum>
       <Maximum>7.43896484609055</Maximum>
       <Linear>true</Linear>
       <Scaling>3</Scaling>
       <Label>y3</Label>
      </Axis>
     </XAxes>
     <YAxes>
      <Axis>
       <Minimum>-18</Minimum>
       <Maximum>2</Maximum>
       <Linear>true</Linear>
       <Scaling>1</Scaling>
       <Label>y4</Label>
      </Axis>
      <Axis>
       <Minimum>-1</Minimum>
       <Maximum>4</Maximum>
       <Linear>true</Linear>
       <Scaling>1</Scaling>
       <Label>vel</Label>
      </Axis>
     </YAxes>
     <ZAxes>
     </ZAxes>
     <Curves>
      <Curve>
       <LineColor>16711935</LineColor>
       <LineStyle>1</LineStyle>
       <TickColor>16711935</TickColor>
       <TickStyle>0</TickStyle>
       <CurveVisible>true</CurveVisible>
       <PixelThresshold>1</PixelThresshold>
       <LineThickness>1</LineThickness>
       <LineOrder>1</LineOrder>
       <ShowYValues>true</ShowYValues>
       <XCurveData>
        <ShowUnit>true</ShowUnit>
        <VarName>robotti_global\Demux\y3</VarName>
       </XCurveData>
       <YCurveData>
        <ShowUnit>true</ShowUnit>
        <VarName>robotti_global\Robotti_model\y4</VarName>
       </YCurveData>
      </Curve>
      <Curve>
       <LineColor>16711680</LineColor>
       <LineStyle>1</LineStyle>
       <TickColor>16711680</TickColor>
       <TickStyle>0</TickStyle>
       <CurveVisible>true</CurveVisible>
       <PixelThresshold>1</PixelThresshold>
       <LineThickness>1</LineThickness>
       <LineOrder>1</LineOrder>
       <ShowYValues>true</ShowYValues>
       <XCurveData>
        <ShowUnit>true</ShowUnit>
        <VarName>robotti_global\Demux\y3</VarName>
       </XCurveData>
       <YCurveData>
        <ShowUnit>true</ShowUnit>
        <VarName>external_tool_global\external_tool\vel</VarName>
       </YCurveData>
      </Curve>
     </Curves>
     <Legenda>
      <ShowLegenda>true</ShowLegenda>
     </Legenda>
    </Plot>
    <Plot>
     <PlotType>GraphPlot</PlotType>
     <BasePlot>
       <PlotId>3</PlotId>
       <UseWindowsBGColor>true</UseWindowsBGColor>
       <BGColor>15790320</BGColor>
       <PlotIsVisible>true</PlotIsVisible>
     </BasePlot>
     <Grid>
      <DrawGrid>true</DrawGrid>
      <GridColor>15780518</GridColor>
      <XTicks>10</XTicks>
      <YTicks>10</YTicks>
      <ZTicks>10</ZTicks>
      <Use3DLook>false</Use3DLook>
     </Grid>
     <PlotBGColor>16777215</PlotBGColor>
     <ShowPlotTitle>true</ShowPlotTitle>
     <TitlePosition>1</TitlePosition>
     <PlotTitle>model</PlotTitle>
     <ShowXValues>true</ShowXValues>
     <Fonts>
      <TitleFont>
       <Name>Arial</Name>
       <Height>12</Height>
       <PitchFamily>34</PitchFamily>
       <Weight>400</Weight>
       <Italic>0</Italic>
       <UnderLine>0</UnderLine>
       <StrikeOut>0</StrikeOut>
       <Color>0</Color>
      </TitleFont>
      <LabelFont>
       <Name>Arial</Name>
       <Height>12</Height>
       <PitchFamily>34</PitchFamily>
       <Weight>400</Weight>
       <Italic>0</Italic>
       <UnderLine>0</UnderLine>
       <StrikeOut>0</StrikeOut>
       <Color>0</Color>
      </LabelFont>
      <ValuesFont>
       <Name>Arial</Name>
       <Height>10</Height>
       <PitchFamily>34</PitchFamily>
       <Weight>400</Weight>
       <Italic>0</Italic>
       <UnderLine>0</UnderLine>
       <StrikeOut>0</StrikeOut>
       <Color>0</Color>
      </ValuesFont>
     </Fonts>
     <SharedXAxis>true</SharedXAxis>
     <SharedYAxis>true</SharedYAxis>
     <SharedZAxis>false</SharedZAxis>
     <XAxes>
      <Axis>
       <Minimum>0</Minimum>
       <Maximum>40</Maximum>
       <Linear>true</Linear>
       <Scaling>3</Scaling>
       <Label>time</Label>
      </Axis>
     </XAxes>
     <YAxes>
      <Axis>
       <Minimum>-0.4</Minimum>
       <Maximum>1.6</Maximum>
       <Linear>true</Linear>
       <Scaling>1</Scaling>
       <Label>d_front_left</Label>
      </Axis>
      <Axis>
       <Minimum>-0.5</Minimum>
       <Maximum>0.5</Maximum>
       <Linear>true</Linear>
       <Scaling>1</Scaling>
       <Label>d_front_right</Label>
      </Axis>
      <Axis>
       <Minimum>-0.5</Minimum>
       <Maximum>0.5</Maximum>
       <Linear>true</Linear>
       <Scaling>1</Scaling>
       <Label>u_r</Label>
      </Axis>
     </YAxes>
     <ZAxes>
     </ZAxes>
     <Curves>
      <Curve>
       <LineColor>16711680</LineColor>
       <LineStyle>1</LineStyle>
       <TickColor>16711680</TickColor>
       <TickStyle>0</TickStyle>
       <CurveVisible>true</CurveVisible>
       <PixelThresshold>1</PixelThresshold>
       <LineThickness>1</LineThickness>
       <LineOrder>1</LineOrder>
       <ShowYValues>true</ShowYValues>
       <XCurveData>
        <ShowUnit>true</ShowUnit>
        <VarName>time</VarName>
       </XCurveData>
       <YCurveData>
        <ShowUnit>true</ShowUnit>
        <VarName>robotti_global\Convert_kinematics\d_front_left</VarName>
       </YCurveData>
      </Curve>
      <Curve>
       <LineColor>16711935</LineColor>
       <LineStyle>1</LineStyle>
       <TickColor>16711935</TickColor>
       <TickStyle>0</TickStyle>
       <CurveVisible>true</CurveVisible>
       <PixelThresshold>1</PixelThresshold>
       <LineThickness>1</LineThickness>
       <LineOrder>1</LineOrder>
       <ShowYValues>true</ShowYValues>
       <XCurveData>
        <ShowUnit>true</ShowUnit>
        <VarName>time</VarName>
       </XCurveData>
       <YCurveData>
        <ShowUnit>true</ShowUnit>
        <VarName>robotti_global\Convert_kinematics\d_front_right</VarName>
       </YCurveData>
      </Curve>
      <Curve>
       <LineColor>255</LineColor>
       <LineStyle>1</LineStyle>
       <TickColor>255</TickColor>
       <TickStyle>0</TickStyle>
       <CurveVisible>true</CurveVisible>
       <PixelThresshold>1</PixelThresshold>
       <LineThickness>1</LineThickness>
       <LineOrder>1</LineOrder>
       <ShowYValues>true</ShowYValues>
       <XCurveData>
        <ShowUnit>true</ShowUnit>
        <VarName>time</VarName>
       </XCurveData>
       <YCurveData>
        <ShowUnit>true</ShowUnit>
        <VarName>robotti_global\Robotti_model\u_r</VarName>
       </YCurveData>
      </Curve>
     </Curves>
     <Legenda>
      <ShowLegenda>true</ShowLegenda>
     </Legenda>
    </Plot>
   </Plots>
   <PlotPanels>
    <PlotPanel>
     <PlotPanelId>1</PlotPanelId>
     <PlotPanelVisible>true</PlotPanelVisible>
     <Name>Window 1</Name>
     <Tiling>2</Tiling>
     <PlotIds>
       <PlotId>1</PlotId>
       <PlotId>2</PlotId>
       <PlotId>3</PlotId>
     </PlotIds>
     <ToggleState>Base</ToggleState>
    </PlotPanel>
   </PlotPanels>
   <WindowRectangles virtualDesktopWidth="3840" virtualDesktopHeight="1080">
     <WindowRectangle monitor="0" left="0" top="0" right="1920" bottom="1080" plotpanelid="1">
0.0598958 0.00277778 0.858854 0.784259
     </WindowRectangle>
   </WindowRectangles>
  </PlotSpecs>
  <RunSpecs>
   <SimulatorSettings>
    <StartTime>0</StartTime>
    <FinishTime>10</FinishTime>
    <Warp>false</Warp>
    <UseOutputAfterEach>false</UseOutputAfterEach>
    <OutputAfterEach>0.1</OutputAfterEach>
    <EventEpsilon>1e-006</EventEpsilon>
    <AlgebraicTolerance>1e-007</AlgebraicTolerance>
    <SteadyStateAnalysis>false</SteadyStateAnalysis>
    <UpdateHoldInstructions>true</UpdateHoldInstructions>
   </SimulatorSettings>
   <IntegrationMethods>
    <IntegrationMethod>
     <Name>Euler</Name>
     <StepSize>0.01</StepSize>
     <AutoStepSize>false</AutoStepSize>
    </IntegrationMethod>
    <IntegrationMethod>
     <Name>BackwardEuler</Name>
     <AbsoluteTolerance>1e-005</AbsoluteTolerance>
     <RelativeTolerance>1e-005</RelativeTolerance>
     <AlgebraicAbsoluteTolerance>1e-005</AlgebraicAbsoluteTolerance>
     <AlgebraicRelativeTolerance>1e-005</AlgebraicRelativeTolerance>
     <StepSize>0.01</StepSize>
     <Alpha>1</Alpha>
    </IntegrationMethod>
    <IntegrationMethod>
     <Name>AdamsBashforth</Name>
     <StepSize>0.01</StepSize>
     <AutoStepSize>false</AutoStepSize>
    </IntegrationMethod>
    <IntegrationMethod>
     <Name>RungeKutta2</Name>
     <StepSize>0.01</StepSize>
     <AutoStepSize>false</AutoStepSize>
    </IntegrationMethod>
    <IntegrationMethod>
     <Name>RungeKutta4</Name>
     <StepSize>0.01</StepSize>
     <AutoStepSize>false</AutoStepSize>
    </IntegrationMethod>
    <IntegrationMethod>
     <Name>RungeKutta8</Name>
     <UseInitialStepSize>false</UseInitialStepSize>
     <InitialStepSize>0.001</InitialStepSize>
     <UseMaximumStepSize>false</UseMaximumStepSize>
     <MaximumStepSize>1</MaximumStepSize>
     <AbsoluteTolerance>1e-006</AbsoluteTolerance>
     <RelativeTolerance>1e-006</RelativeTolerance>
     <SafetyFactor>0.9</SafetyFactor>
     <Factor1>0.33</Factor1>
     <Factor2>6</Factor2>
     <Beta>0</Beta>
     <UseMaxNrSteps>false</UseMaxNrSteps>
     <MaxNrSteps>100000</MaxNrSteps>
     <UseStiffDetection>false</UseStiffDetection>
     <MaxNrStiffnessSteps>1000</MaxNrStiffnessSteps>
    </IntegrationMethod>
    <IntegrationMethod>
     <Name>RungeKuttaFehlberg</Name>
     <UseInitialStepSize>false</UseInitialStepSize>
     <InitialStepSize>0.001</InitialStepSize>
     <UseMaximumStepSize>false</UseMaximumStepSize>
     <MaximumStepSize>1</MaximumStepSize>
     <AbsoluteTolerance>1e-006</AbsoluteTolerance>
     <RelativeTolerance>1e-006</RelativeTolerance>
    </IntegrationMethod>
    <IntegrationMethod>
     <Name>VodeAdams</Name>
     <UseInitialStepSize>false</UseInitialStepSize>
     <InitialStepSize>0.001</InitialStepSize>
     <UseMaximumStepSize>false</UseMaximumStepSize>
     <MaximumStepSize>1</MaximumStepSize>
     <AbsoluteTolerance>1e-006</AbsoluteTolerance>
     <RelativeTolerance>1e-006</RelativeTolerance>
     <VodeUseBDF>true</VodeUseBDF>
     <VodeUseNewton>true</VodeUseNewton>
    </IntegrationMethod>
    <IntegrationMethod>
     <Name>BDFMethod</Name>
     <AbsoluteTolerance>1e-005</AbsoluteTolerance>
     <RelativeTolerance>1e-005</RelativeTolerance>
     <AlgebraicAbsoluteTolerance>1e-005</AlgebraicAbsoluteTolerance>
     <AlgebraicRelativeTolerance>1e-005</AlgebraicRelativeTolerance>
     <UseInitialStepSize>false</UseInitialStepSize>
     <InitialStepSize>0.001</InitialStepSize>
     <UseMaximumStepSize>false</UseMaximumStepSize>
     <MaximumStepSize>1</MaximumStepSize>
     <UseFixedStepSize>false</UseFixedStepSize>
     <FixedStepSize>0</FixedStepSize>
    </IntegrationMethod>
    <IntegrationMethod>
     <Name>MeBDFiMethod</Name>
     <AbsoluteTolerance>1e-005</AbsoluteTolerance>
     <RelativeTolerance>1e-005</RelativeTolerance>
     <AlgebraicAbsoluteTolerance>1e-005</AlgebraicAbsoluteTolerance>
     <AlgebraicRelativeTolerance>1e-005</AlgebraicRelativeTolerance>
     <UseInitialStepSize>false</UseInitialStepSize>
     <InitialStepSize>0.001</InitialStepSize>
     <UseMaximumStepSize>false</UseMaximumStepSize>
     <MaximumStepSize>1</MaximumStepSize>
     <UseFixedStepSize>false</UseFixedStepSize>
     <FixedStepSize>0</FixedStepSize>
    </IntegrationMethod>
    <SelectedIntegrationMethod>8</SelectedIntegrationMethod>
   </IntegrationMethods>
  </RunSpecs>
  <MultipleRun>
   <NrSteps>10</NrSteps>
   <CopyFromStates>false</CopyFromStates>
   <JoinParameterVariation>true</JoinParameterVariation>
   <ClearAfterRun>true</ClearAfterRun>
   <RedrawAfterRun>false</RedrawAfterRun>
   <DrawDuringSimulation>true</DrawDuringSimulation>
   <ActionBeforeOptimization>0</ActionBeforeOptimization>
   <CompareValue>0</CompareValue>
   <UseCompareValue>true</UseCompareValue>
   <MultipleRunType>MultipleRun</MultipleRunType>
   <Minimize>true</Minimize>
   <OptimizationVariable></OptimizationVariable>
   <ResulVarUsage>UseEndValue</ResulVarUsage>
   <Tolerance>0.001</Tolerance>
   <OptimizationMethod>BroydonFletcherGoldfarbShanno</OptimizationMethod>
   <MultipleRunVariables>
   </MultipleRunVariables>
  </MultipleRun>
  <ExportData>
   <WriteAsText>true</WriteAsText>
   <ReadAsText>true</ReadAsText>
   <WriteHeader>true</WriteHeader>
   <ReadHeader>true</ReadHeader>
   <ReadFilename></ReadFilename>
   <WriteFilename></WriteFilename>
   <DoWrite>false</DoWrite>
   <ExportVariables>
   </ExportVariables>
   <ImportVariables>
   </ImportVariables>
  </ExportData>
  <BreakPoints>
  </BreakPoints>
  <AnimationPlayback>
   <PlaybackSpeed>1</PlaybackSpeed>
  </AnimationPlayback>
</ExpData>
  </Experiment>
</Experiments>
</Document>
